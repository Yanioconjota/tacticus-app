<div class="login-container">
  <mat-card class="login-card">
    <mat-card-header>
      <mat-card-title>Tacticus API Login</mat-card-title>
      <mat-card-subtitle>Enter your API keys to access the application</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form (ngSubmit)="onSubmit()" class="login-form">
        <!-- Player API Key (Required) -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Player API Key</mat-label>
          <input
            matInput
            [type]="showPlayerPassword() ? 'text' : 'password'"
            [value]="playerApiKey()"
            (input)="onPlayerApiKeyChange($any($event.target).value)"
            placeholder="Enter your Player API key"
            [disabled]="isLoading()"
            required>
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="togglePlayerPasswordVisibility()"
            [attr.aria-label]="'Toggle password visibility'"
            [attr.aria-pressed]="showPlayerPassword()">
            <mat-icon>{{showPlayerPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
        </mat-form-field>

        <!-- Officer Access Toggle -->
        <div class="officer-toggle">
          <mat-checkbox
            [checked]="showOfficerField()"
            (change)="onOfficerFieldToggle()">
            I have officer access (for guild data)
          </mat-checkbox>
        </div>

        <!-- Firebase Access Toggle (only when officer is enabled) -->
        @if (showOfficerField()) {
          <div class="firebase-toggle">
            <mat-checkbox
              [checked]="useFirebaseAuth()"
              (change)="onFirebaseAuthToggle()">
              Use Firebase authentication for enhanced data
            </mat-checkbox>
          </div>
        }

        <!-- Officer API Key (Optional) -->
        @if (showOfficerField()) {
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Officer API Key</mat-label>
            <input
              matInput
              [type]="showOfficerPassword() ? 'text' : 'password'"
              [value]="officerApiKey()"
              (input)="onOfficerApiKeyChange($any($event.target).value)"
              placeholder="Enter your Officer API key"
              [disabled]="isLoading()">
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="toggleOfficerPasswordVisibility()"
              [attr.aria-label]="'Toggle password visibility'"
              [attr.aria-pressed]="showOfficerPassword()">
              <mat-icon>{{showOfficerPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
          </mat-form-field>
        }

        <!-- Firebase Authentication Fields (only when both officer and firebase are enabled) -->
        @if (showOfficerField() && useFirebaseAuth()) {
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Firebase Email</mat-label>
            <input
              matInput
              type="email"
              [value]="firebaseEmail()"
              (input)="onFirebaseEmailChange($any($event.target).value)"
              placeholder="Enter your Firebase email"
              [disabled]="isLoading()"
              required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Firebase Password</mat-label>
            <input
              matInput
              [type]="showFirebasePassword() ? 'text' : 'password'"
              [value]="firebasePassword()"
              (input)="onFirebasePasswordChange($any($event.target).value)"
              placeholder="Enter your Firebase password"
              [disabled]="isLoading()"
              required>
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="toggleFirebasePasswordVisibility()"
              [attr.aria-label]="'Toggle password visibility'"
              [attr.aria-pressed]="showFirebasePassword()">
              <mat-icon>{{showFirebasePassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
          </mat-form-field>
        }

        @if (errorMessage()) {
          <div class="error-message">
            <mat-icon>error</mat-icon>
            <span>{{ errorMessage() }}</span>
          </div>
        }

        <div class="login-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="isLoading() || !isFormValid()"
            class="login-button">
            <ng-container>
              @if (isLoading()) {
                <mat-icon>hourglass_empty</mat-icon>
                <span>Logging in...</span>
              } @else {
                <mat-icon>login</mat-icon>
                <span>Login</span>
              }
            </ng-container>
          </button>
        </div>
      </form>
    </mat-card-content>

    <mat-card-footer>
      <p class="help-text">
        <strong>Player API Key:</strong> Required for basic player data.<br>
        <strong>Officer API Key:</strong> Optional, needed for guild and raid data.<br>
        <strong>Firebase Auth:</strong> Optional, enables enhanced data when combined with Officer access.
      </p>
    </mat-card-footer>
  </mat-card>
</div>
